# 实验二：双机通信实验（C/S模式）

## 实验目的
掌握双机串口通信的交叉连接方法，理解并实现C/S（客户端/服务器）模式的通信逻辑。

## 文件说明

### server.py - 服务器端程序
- 监听客户端请求
- 处理不同类型的请求
- 返回相应的响应

### client.py - 客户端程序
- 向服务器发送请求
- 接收并显示服务器响应
- 提供交互式命令界面

## 运行步骤

### 1. 硬件连接
使用串口线（交叉连接）连接两台计算机：
- 计算机A的发送引脚(TX) 连接到 计算机B的接收引脚(RX)
- 计算机B的发送引脚(TX) 连接到 计算机A的接收引脚(RX)
- 共地连接(GND)

### 2. 启动服务器
在一台计算机上运行服务器程序：
```bash
python server.py
```
按提示选择串口和波特率（两端必须一致）

### 3. 启动客户端
在另一台计算机上运行客户端程序：
```bash
python client.py
```
按提示选择串口和波特率

### 4. 使用客户端发送命令
客户端支持以下命令：
- `HELLO` - 向服务器发送问候
- `TIME` - 请求服务器当前时间
- `ECHO <msg>` - 回显消息，例如：`ECHO Hello World`
- `CALC <expr>` - 计算表达式，例如：`CALC 2+3*4`
- `QUIT` - 断开连接并退出

## 通信协议

### 请求格式
```
<COMMAND> [参数]\n
```

### 响应格式
```
SERVER: <响应内容>\n
```

### 支持的命令

| 命令 | 参数 | 说明 | 示例 |
|------|------|------|------|
| HELLO | 无 | 建立连接问候 | `HELLO` |
| TIME | 无 | 获取服务器时间 | `TIME` |
| ECHO | 消息内容 | 回显消息 | `ECHO Hello` |
| CALC | 数学表达式 | 计算表达式 | `CALC 2+3` |
| QUIT | 无 | 断开连接 | `QUIT` |

## 功能特点

1. **自动连接建立**：客户端启动后自动发送HELLO请求
2. **多命令支持**：支持问候、时间查询、回显、计算等多种服务
3. **实时响应**：服务器实时处理请求并返回响应
4. **友好界面**：清晰的命令提示和状态显示
5. **异常处理**：包含错误处理和优雅退出机制

## 注意事项

1. **波特率设置**：两端必须使用相同的波特率（建议9600）
2. **串口选择**：确保选择正确的串口号
3. **硬件连接**：确认串口线连接正确（TX-RX交叉）
4. **运行顺序**：建议先启动服务器，再启动客户端
5. **退出方式**：使用QUIT命令正常退出，避免直接关闭窗口

## 测试示例

### 场景1：基本连接测试
```
客户端发送: HELLO
服务器响应: SERVER: Hello, Client! Connection established.
```

### 场景2：时间查询
```
客户端发送: TIME
服务器响应: SERVER: Current time is 2026-01-15 10:30:45
```

### 场景3：回显服务
```
客户端发送: ECHO This is a test message
服务器响应: SERVER: ECHO - This is a test message
```

### 场景4：计算服务
```
客户端发送: CALC 2+3*4
服务器响应: SERVER: CALC - 2+3*4 = 14
```

## 扩展功能建议

1. 添加文件传输功能
2. 实现数据加密
3. 支持多客户端连接
4. 添加日志记录功能
5. 实现心跳检测机制
